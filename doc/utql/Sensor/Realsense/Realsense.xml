<?xml version="1.0" encoding="UTF-8"?>

<UTQLPatternTemplates xmlns='http://ar.in.tum.de/ubitrack/utql'
                      xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
                      xmlns:xi='http://www.w3.org/2001/XInclude'
                      xmlns:h="http://www.w3.org/1999/xhtml"
                      xsi:schemaLocation='http://ar.in.tum.de/ubitrack/utql ../../../schema/utql_templates.xsd'>

    <Pattern name="RealsenseColorVideoStream" displayName="Realsense Color VideoStream">
        <Description>
            <h:p>
                This component grabs color images from a Realsense device and pushes them.
            </h:p>
        </Description>
        <Output>
            <Node name="ColorCamera" displayName="Color Camera" >
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Realsense Color Camera</p></Description>
            </Node>
            <Node name="ColorImagePlane" displayName="Image Plane" />
            <Edge name="ImageOutput" source="ColorCamera" destination="ColorImagePlane" displayName="Output Color Image">
                <Description>
                    <h:p>The output image.</h:p>
                </Description>
                <Attribute name="type" value="Image" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>

        <DataflowConfiguration>
            <UbitrackLib class="RealsenseVideoStream" />

            <Attribute name="rsSerialNumber" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="rsColorVideoStreamFormat" value="BGR8" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsColorVideoResolution" value="1920x1080" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsFrameRate" value="30" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="rsSensorType" value="VIDEO" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsStreamType" value="COLOR" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsStreamIndex" value="0" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="uploadImageOnGPU" displayName="Automatic Upload on GPU" default="false" xsi:type="EnumAttributeDeclarationType">
                <Description>
                    <h:p>
                        Each grabbed Image is automatically uploaded to the GPU for further processing. Attention: Uploading and downloading images from the GPU is time consuming.
                    </h:p>
                </Description>
                <EnumValue name="false" displayName="False"/>
                <EnumValue name="true"  displayName="True"/>
            </Attribute>

        </DataflowConfiguration>
    </Pattern>

    <Pattern name="RealsenseLeftInfraredVideoStream" displayName="Realsense Left Infrared VideoStream">
        <Description>
            <h:p>
                This component grabs left infrared images from a Realsense device and pushes them.
            </h:p>
        </Description>
        <Output>
            <Node name="IRCameraLeft" displayName="Left Infrared Camera" >
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Realsense Left Infrared Camera</p></Description>
            </Node>
            <Node name="IRImagePlaneLeft" displayName="Image Plane" />
            <Edge name="ImageOutput" source="IRCameraLeft" destination="IRImagePlaneLeft" displayName="Output Infrared Image">
                <Description>
                    <h:p>The output image.</h:p>
                </Description>
                <Attribute name="type" value="Image" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>

        <DataflowConfiguration>
            <UbitrackLib class="RealsenseVideoStream" />

            <Attribute name="rsSerialNumber" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="rsInfraredVideoStreamFormat" value="Y8" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsInfraredVideoResolution" value="1280x720" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsFrameRate" value="30" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="rsSensorType" value="VIDEO" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsStreamType" value="INFRARED" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsStreamIndex" value="1" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="uploadImageOnGPU" displayName="Automatic Upload on GPU" default="false" xsi:type="EnumAttributeDeclarationType">
                <Description>
                    <h:p>
                        Each grabbed Image is automatically uploaded to the GPU for further processing. Attention: Uploading and downloading images from the GPU is time consuming.
                    </h:p>
                </Description>
                <EnumValue name="false" displayName="False"/>
                <EnumValue name="true"  displayName="True"/>
            </Attribute>

        </DataflowConfiguration>
    </Pattern>

    <Pattern name="RealsenseRightInfraredVideoStream" displayName="Realsense Right Infrared VideoStream">
        <Description>
            <h:p>
                This component grabs right infrared images from a Realsense device and pushes them.
            </h:p>
        </Description>
        <Output>
            <Node name="IRCameraRight" displayName="Right Infrared Camera" >
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Realsense Right Infrared Camera</p></Description>
            </Node>
            <Node name="IRImagePlaneRight" displayName="Image Plane" />
            <Edge name="ImageOutput" source="IRCameraRight" destination="IRImagePlaneRight" displayName="Output Infrared Image">
                <Description>
                    <h:p>The output image.</h:p>
                </Description>
                <Attribute name="type" value="Image" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>

        <DataflowConfiguration>
            <UbitrackLib class="RealsenseVideoStream" />

            <Attribute name="rsSerialNumber" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="rsInfraredVideoStreamFormat" value="Y8" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsInfraredVideoResolution" value="1280x720" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsFrameRate" value="30" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="rsSensorType" value="VIDEO" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsStreamType" value="INFRARED" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsStreamIndex" value="2" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="uploadImageOnGPU" displayName="Automatic Upload on GPU" default="false" xsi:type="EnumAttributeDeclarationType">
                <Description>
                    <h:p>
                        Each grabbed Image is automatically uploaded to the GPU for further processing. Attention: Uploading and downloading images from the GPU is time consuming.
                    </h:p>
                </Description>
                <EnumValue name="false" displayName="False"/>
                <EnumValue name="true"  displayName="True"/>
            </Attribute>

        </DataflowConfiguration>
    </Pattern>


    <Pattern name="RealsensePointCloud" displayName="Realsense Point Cloud">
        <Description>
            <h:p>
                This component retrieves the 3D Pointclouds from a Realsense device and pushes them.
            </h:p>
        </Description>
        <Output>
            <Node name="IRCameraLeft" displayName="Left Infrared Camera" >
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Realsense Left Infrared Camera</p></Description>
            </Node>
            <Node name="PointCloud" displayName="3D Point Cloud" />
            <Node name="IRImagePlaneLeft" displayName="Image Plane" />
            <Edge name="DepthImageOutput" source="IRCameraLeft" destination="IRImagePlaneLeft" displayName="Output Depth Image">
                <Description>
                    <h:p>The output depth image.</h:p>
                </Description>
                <Attribute name="type" value="Image" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="PointCloudOutput" source="IRCameraLeft" destination="PointCloud" displayName="Output PointCloud">
                <Description>
                    <h:p>The output point cloud.</h:p>
                </Description>
                <Attribute name="type" value="3DPositionList" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>

        <DataflowConfiguration>
            <UbitrackLib class="RealsensePointCloud" />

            <Attribute name="rsSerialNumber" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="rsDepthResolution" value="1280x720" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsFrameRate" value="30" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="rsDepthStreamFormat" value="Z16" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsSensorType" value="DEPTH" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsStreamType" value="DEPTH" xsi:type="EnumAttributeReferenceType"/>
            <Attribute name="rsStreamIndex" value="0" xsi:type="IntAttributeReferenceType"/>

            <Attribute name="uploadImageOnGPU" displayName="Automatic Upload on GPU" default="false" xsi:type="EnumAttributeDeclarationType">
                <Description>
                    <h:p>
                        Each grabbed Image is automatically uploaded to the GPU for further processing. Attention: Uploading and downloading images from the GPU is time consuming.
                    </h:p>
                </Description>
                <EnumValue name="false" displayName="False"/>
                <EnumValue name="true"  displayName="True"/>
            </Attribute>

        </DataflowConfiguration>
    </Pattern>

    <Pattern name="RealsenseD435CameraCalibration" displayName="D435 Realsense Camera Calibration">
        <Description>
            <h:p>
                This component provides access to the D435 Realsense Camera Calibration.
            </h:p>
        </Description>
        <Output>
            <Node name="IRCameraLeft" displayName="Left Infrared Camera" >
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Realsense Left Infrared Camera</p></Description>
            </Node>
            <Node name="IRCameraRight" displayName="Right Infrared Camera" >
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Realsense Right Infrared Camera</p></Description>
            </Node>
            <Node name="ColorCamera" displayName="Color Camera" >
                <Description><p xmlns="http://www.w3.org/1999/xhtml">Realsense Color Camera</p></Description>
            </Node>
            <Node name="IRImagePlaneLeft" displayName="Infrared Image Plane Left" />
            <Node name="IRImagePlaneRight" displayName="Infrared Image Plane Right" />
            <Node name="ColorImagePlane" displayName="Color Image Plane" />

            <Edge name="IRLeftIntrinsics" source="IRCameraLeft" destination="IRImagePlaneLeft" displayName="Infrared Camera Intrinsics Left">
                <Description>
                    <h:p>The intrinsic infrared camera matrix left.</h:p>
                </Description>
                <Attribute name="type" value="3x3Matrix" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="pull" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="IRLeftCameraModel" source="IRCameraLeft"    destination="IRImagePlaneLeft" displayName="Infrared Camera Model Left">
                <Description>
                    <h:p>The infrared camera model left.</h:p>
                </Description>
                <Attribute name="type" value="Intrinsics" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="pull" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="IRRightIntrinsics" source="IRCameraRight" destination="IRImagePlaneRight" displayName="Infrared Camera Intrinsics Right">
                <Description>
                    <h:p>The intrinsic infrared camera matrix right.</h:p>
                </Description>
                <Attribute name="type" value="3x3Matrix" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="pull" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="RightCameraModel" source="IRCameraRight"    destination="IRImagePlaneRight" displayName="Infrared Camera Model Right">
                <Description>
                    <h:p>The infrared camera model right.</h:p>
                </Description>
                <Attribute name="type" value="Intrinsics" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="pull" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="ColorIntrinsics" source="ColorCamera" destination="ColorImagePlane" displayName="Color Camera Intrinsics Right">
                <Description>
                    <h:p>The intrinsic color camera matrix.</h:p>
                </Description>
                <Attribute name="type" value="3x3Matrix" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="pull" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="ColorCameraModel" source="ColorCamera"    destination="ColorImagePlane" displayName="Color Camera Model Right">
                <Description>
                    <h:p>The color camera model.</h:p>
                </Description>
                <Attribute name="type" value="Intrinsics" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="pull" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="LeftToRightTransform" source="IRCameraLeft" destination="IRCameraRight" displayName="Infrared Camera Left To Right Transform">
                <Description>
                    <h:p>The left infrared camera to right infrared camera transform.</h:p>
                </Description>
                <Attribute name="type" value="6D" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="pull" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
            <Edge name="LeftToColorTransform" source="IRCameraLeft" destination="ColorCamera" displayName="Infrared Camera Left To Color Camera Transform">
                <Description>
                    <h:p>The left infrared camera to color camera transform.</h:p>
                </Description>
                <Attribute name="type" value="6D" xsi:type="EnumAttributeReferenceType"/>
                <Attribute name="mode" value="pull" xsi:type="EnumAttributeReferenceType"/>
            </Edge>
        </Output>

        <DataflowConfiguration>
            <UbitrackLib class="RealsenseCameraCalibration" />

            <Attribute name="rsSerialNumber" xsi:type="IntAttributeReferenceType"/>

        </DataflowConfiguration>
    </Pattern>

    <!-- Attribute declarations -->

    <GlobalNodeAttributeDeclarations>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/1/1)" />

    </GlobalNodeAttributeDeclarations>

    <GlobalEdgeAttributeDeclarations>
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/1)" />
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/2)" />
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/3)" />
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/4)" />
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/5)" />
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/6)" />
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/7)" />
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/8)" />

    </GlobalEdgeAttributeDeclarations>

    <GlobalDataflowAttributeDeclarations>
        <!-- Unfortunately, the xpointer used in Xinclude is currently restricted to the element scheme and absolute element indices in Xerces (and thus XMLBeans) -->
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/1)" />
        <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/2)" />

        <Attribute name="rsSerialNumber" displayName="Realsense Serial Number" default="0" xsi:type="IntAttributeDeclarationType">
            <Description><p xmlns="http://www.w3.org/1999/xhtml">Serial Number of the Realsense Device.</p></Description>
        </Attribute>

        <Attribute name="rsSensorType" displayName="Realsense Sensor Type" constant="true" default="VIDEO" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Sensor Type for the Stream.
                </h:p>
            </Description>

            <EnumValue name="CONFIG" displayName="Config"/>
            <EnumValue name="VIDEO" displayName="Video"/>
            <EnumValue name="DEPTH"  displayName="Depth"/>
        </Attribute>

        <Attribute name="rsStreamType" displayName="Stream Type" default="COLOR" constant="true" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Select Realsense Stream Type.
                </h:p>
            </Description>

            <EnumValue name="COLOR" displayName="COLOR"/>
            <EnumValue name="INFRARED" displayName="INFRARED"/>
            <EnumValue name="DEPTH" displayName="DEPTH"/>
            <!--<EnumValue name="CONFIDENCE" displayName="CONFIDENCE"/>-->
            <!--<EnumValue name="ACCEL" displayName="ACCEL"/>-->
            <!--<EnumValue name="GYRO" displayName="GYRO"/>-->
            <!--<EnumValue name="POSE" displayName="POSE"/>-->
            <!--<EnumValue name="FISHEYE" displayName="FISHEYE"/>-->
            <!--<EnumValue name="GPIO" displayName="GPIO"/>-->
        </Attribute>

        <Attribute name="rsStreamIndex" displayName="Stream Index" constant="true" default="0" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Select Stream Index.
                </h:p>
            </Description>

            <EnumValue name="0" displayName="0"/>
            <EnumValue name="1" displayName="1"/>
            <EnumValue name="2" displayName="2"/>
        </Attribute>

        <Attribute name="rsColorVideoStreamFormat" displayName="Color Video Stream Format" default="BGR8" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Select Color Video Stream Format.
                </h:p>
            </Description>

            <EnumValue name="RGB8" displayName="RGB8"/>
            <EnumValue name="BGR8" displayName="BGR8"/>
            <EnumValue name="RGBA8" displayName="RGBA8"/>
            <EnumValue name="BGRA8" displayName="BGRA8"/>
            <EnumValue name="YUYV" displayName="YUYV"/>
            <EnumValue name="Y16" displayName="Y16"/>
        </Attribute>

        <Attribute name="rsInfraredVideoStreamFormat" displayName="Infrared Video Stream Format" default="BGR8" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Select Infrared Video Stream Format.
                </h:p>
            </Description>

            <EnumValue name="Y8" displayName="Y8"/>
            <EnumValue name="Y16" displayName="Y16"/>
        </Attribute>

        <Attribute name="rsDepthStreamFormat" displayName="Depth Stream Format" constant="true" default="Z16" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Select Depth Stream Format.
                </h:p>
            </Description>

            <EnumValue name="Z16" displayName="Z16"/>
        </Attribute>

        <Attribute name="rsColorVideoResolution" displayName="Color Video Stream Resolution" default="1920x1080" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Select Color Stream Resolution.
                </h:p>
            </Description>

            <EnumValue name="1920x1080" displayName="1920x1080"/>
            <EnumValue name="1280x720" displayName="1280x720"/>
            <EnumValue name="960x540" displayName="960x540"/>
            <EnumValue name="848x480" displayName="848x480"/>
            <EnumValue name="640x480" displayName="640x480"/>
            <EnumValue name="640x360" displayName="640x360"/>
            <EnumValue name="424x240" displayName="424x240"/>
            <EnumValue name="320x240" displayName="320x240"/>
            <EnumValue name="320x180" displayName="320x180"/>
        </Attribute>

        <Attribute name="rsInfraredVideoResolution" displayName="Infrared Video Stream Resolution" default="1280x720" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Select Infrared Stream Resolution.
                </h:p>
            </Description>

            <EnumValue name="1280x800" displayName="1280x800"/>
            <EnumValue name="1280x720" displayName="1280x720"/>
            <EnumValue name="848x480" displayName="848x480"/>
            <EnumValue name="640x480" displayName="640x480"/>
            <EnumValue name="640x400" displayName="640x400"/>
            <EnumValue name="640x360" displayName="640x360"/>
            <EnumValue name="480x270" displayName="480x270"/>
            <EnumValue name="424x240" displayName="424x240"/>
        </Attribute>

        <Attribute name="rsDepthResolution" displayName="Depth Stream Resolution" default="1280x720" xsi:type="EnumAttributeDeclarationType">
            <Description>
                <h:p>
                    Select Depth Stream Resolution.
                </h:p>
            </Description>

            <EnumValue name="1280x720" displayName="1280x720"/>
            <EnumValue name="848x480" displayName="848x480"/>
            <EnumValue name="640x480" displayName="640x480"/>
            <EnumValue name="640x360" displayName="640x360"/>
            <EnumValue name="480x270" displayName="480x270"/>
            <EnumValue name="424x240" displayName="424x240"/>
        </Attribute>

    </GlobalDataflowAttributeDeclarations>

</UTQLPatternTemplates>

